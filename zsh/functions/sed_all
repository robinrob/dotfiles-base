local +r SedExpression
local +r FindExpression
local +r Where='.'
local +r MaxDepth
local +r Inplace

while getopts :s:f:w:d:i: name
do
	case $name in
		s) SedExpression="$OPTARG" ;;
    f) FindExpression="$OPTARG" ;;
    w) Where="$OPTARG" ;;
    d) MaxDepth="-maxdepth $OPTARG" ;;
    i) Inplace="-i" ;;
    *) red 'sed_all -s <sed-expression> -f <find-expression> -w <where> -d <depth>'
	esac
done


IFS=" 
"
for file in $(gfind $Where ${=MaxDepth} -name "$FindExpression" -type f)
do
  # Single-quotes around the $SedExpression are critical here
  # local +r SedSubExpr = (${(s///SedExpression)})
  # print $SedSubExpr
  cmd="gsed $Inplace '$SedExpression' $file"
  yellow $cmd
  eval $cmd
done
